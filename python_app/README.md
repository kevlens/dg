# Python 版本的断轨基础数据工具

该目录包含原 WinForms 工具的 Python 迁移版本。最新实现基于 `tkinter` 提供与
WinForms 相似的图形界面，可完成数据库连接、区间与定标器浏览、数据修改及 SQL
脚本导出等功能。

## 运行环境

1. 安装 Python 3.10 及以上版本。
2. 安装依赖：

   ```bash
   pip install pyodbc
   ```

程序默认使用 **ODBC Driver 17 for SQL Server**。如目标服务器使用其他驱动，请按
需求调整 `python_app/app.py` 中的连接字符串。

## 启动方式

推荐使用 **PyCharm** 进行运行与调试，以便直接在界面中设置断点。操作步骤：

1. 推荐直接使用 PyCharm 打开仓库根目录。如果仅打开 `DG/` 目录（原 WinForms
   解决方案），也可以运行 Python 版：仓库在该目录下放置了一个
   [`sitecustomize.py`](../DG/sitecustomize.py)，会在解释器启动时自动把仓库根目录
   加到 `PYTHONPATH`，从而保证 `python_app.app` 能被正常导入。
2. 在 "Run/Debug Configurations" 中新增一个 *Module name* 运行配置，模块填入
   `python_app.app`。
3. 选择合适的 Python 解释器（需已安装 `pyodbc`）。
4. 点击 **Run** 或 **Debug** 按钮即可启动 Tkinter 程序。

程序启动后会显示图形界面：

1. 在顶部输入服务器、数据库、用户名和密码，点击“连接”建立数据库连接。
2. 成功连接后左侧列出所有区间，选中区间即可查看详细信息并在右侧列出所属定标器。
3. 通过“更新区间信息”“更新定标器”“删除定标器”按钮可以记录修改或删除操作。
   修改时会弹出一个统一的编辑窗口，可一次性完成所有字段调整。
4. 所有操作会出现在界面下方的“已记录操作”列表中，列表会展示主键信息及修改
   内容，方便核对；点击“生成操作 SQL”即可导出与 WinForms 工具一致的 SQL 脚本，
   文件保存在当前目录的 `SQL/` 文件夹内。

## 菜单与快捷操作

* 顶部“系统”菜单包含 WinForms 版的主要功能：
  * “重新加载”可重新读取区间与定标器；
  * “初始化内网数据”会一次性导出区间、定标器、画线及分界线的全量 SQL，文件会带有 `INIT_` 前缀；
  * “分界线数据”会打开一个独立窗口浏览全部分界线记录；
  * “新增区间”“新增定标器”可直接录入新记录并写入待执行队列；
  * “生成操作 SQL”与按钮功能一致，用于导出当前积累的增删改脚本。
* “导入”菜单保留了 WinForms 的入口，当前版本尚未开放具体导入流程，点击后会给出提示。
* “备份”菜单会将区间、定标器、画线和分界线分别导出为 `Backups/` 目录下的 CSV 文件，便于快速留存现状数据。
* 区间列表与定标器列表均支持右键菜单，除了新增/删除外，定标器还可以直接删除画线或批量更换手机号，所有操作都会同步反映到“已记录操作”列表中。

关闭窗口会自动断开数据库连接并结束后台保活线程。
